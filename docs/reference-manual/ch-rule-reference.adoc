== Rule Reference

Rules are an encapsulated form of logic used in inspect data. They are comprised of metadata, such as an ID and revision, take input, execute an operation and optionally perform actions.  Input can be manipulated via transformations before the operation is executed and actions can be modified through rule modifiers (such as specifying a status code or message. The following is a reference to the rule components. For a better understanding of how to write rules, see the chapter on <<_inspection>>.

=== Rule Metadata

TODO: General description.

==== logdata
[cols=">h,<9"]
|===============================================================================
|Description|Add data to be logged with the event.
|       Type|Metadata
|     Syntax|`logdata:<value>`
|Cardinality|0..1
|     Module|core
|    Version|0.2
|===============================================================================

Log a data fragment as part of the error message.

----
Rule ARGS @rx pattern \
        "msg:Test matched" logdata:%{MATCHED_VAR}
----

NOTE: Up to 128 bytes of data will be recorded.

==== confidence
[cols=">h,<9"]
|===============================================================================
|Description|Numeric value indicating the confidence of the rule.
|       Type|Metadata
|     Syntax|`confidence:<0-100>`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

Higher confidence rules should have a lower False Positive rate.

==== id
[cols=">h,<9"]
|===============================================================================
|Description|Unique identifier for a rule.
|       Type|Metadata
|     Syntax|`id:<value>`
|Cardinality|1
|     Module|core
|    Version|0.4
|===============================================================================

Specifies a unique identifier for a rule. If a later rule re-uses the same identifier, then it will overwrite the previous rule.

TODO: Explain what the full unique id is (taking context and chains into account)

==== msg
[cols=">h,<9"]
|===============================================================================
|Description|Message associated with the rule.
|       Type|Metadata
|     Syntax|`msg:<text>`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

This message is used by the `event` action when logging the event.

==== phase
[cols=">h,<9"]
|===============================================================================
|Description|The runtime phase at which the rule should execute.
|       Type|Metadata
|     Syntax|`phase:<phase-name>`
|Cardinality|1
|     Module|core
|    Version|0.4
|===============================================================================

Rule phase determines when a rule runs. IronBee understands the following phases:

REQUEST_HEADER::
  Invoked after the entire HTTP request headers has been read, but before reading the HTTP request body (if any). Most rules should not use this phase, opting for the REQUEST phase instead.

REQUEST_HEADER_PROCESS::
  Invoked after the REQUEST_HEADER phase to allow for processing the phase, such as invoking blocking rules.

REQUEST::
  Invoked after receiving the entire HTTP request, which may involve request body and request trailers, but it will run even when neither is present.

REQUEST_PROCESS::
  Invoked after the REQUEST phase to allow for processing the phase, such as invoking blocking rules.

RESPONSE_HEADER::
  Invoked after receiving the HTTP entire response header.

RESPONSE_HEADER_PROCESS::
  Invoked after the RESPONSE_HEADER phase to allow for processing the phase, such as invoking blocking rules.

RESPONSE::
  Invoked after receiving the HTTP response body (if any) and response trailers (if any).

RESPONSE_PROCESS::
  Invoked after the RESPONSE phase to allow for processing the phase, such as invoking blocking rules.

POSTPROCESS::
  Invoked after the entire transaction has been processed. This phase is for logging and tracking data between transactions, such as storing state. Actions cannot affect the transaction in this phase.

==== rev
[cols=">h,<9"]
|===============================================================================
|Description|An integer rule revision.
|       Type|Metadata
|     Syntax|`rev:n`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

TODO: Explain how this is used in RuleEnable and when overriding Rules in sub contexts.

==== severity
[cols=">h,<9"]
|===============================================================================
|Description|Numeric value indicating the severity of the issue this rule is trying to protect against.
|       Type|Metadata
|     Syntax|`severity:<0-100>`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

The severity indicates how much impact a successful attack may be, but does not indicate the quality of protection this rule may provide. The severity is meant to be used as part of a "threat level" indicator. The "threat level" is essentially severity x confidence, which balances how severe the threat may be with how well this rule might be protecting against it.

==== tag
[cols=">h,<9"]
|===============================================================================
|Description|Apply an arbitrary tag name to a rule.
|       Type|Metadata
|     Syntax|`tag:<value>`
|Cardinality|0..n
|     Module|core
|    Version|0.4
|===============================================================================

TODO: Describe where this is used, notably `RuleEnable`/`RuleDisable` and logged with events.

=== Data Fields

TODO: General description.

==== ARGS
[cols=">h,<9"]
|===============================================================================
|Description|All request parameters combined and normalized.
|       Type|Collection
|      Scope|Transaction (`REQUEST_HEADERS`, `REQUEST_BODY`)
|     Module|core
|    Version|0.2
|===============================================================================

The `ARGS` collection is currently the same as specifying `REQUEST_URL_PARAMS REQUEST_BODY_PARAMS`, but gathered in a single collection.

NOTE: The names and values are already URL decoded.

==== AUTH_PASSWORD
[cols=">h,<9"]
|===============================================================================
|Description|Basic authentication password.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.7
|===============================================================================

==== AUTH_TYPE
[cols=">h,<9"]
|===============================================================================
|Description|Indicator of the authentication method used.
|       Type|Collection
|      Scope|Transaction
|     Module|core
|    Version|0.7
|===============================================================================

This field contains the first token extracted from the `Authorization` request header. Typical values are: `Basic`, `Digest`, and `NTLM`.

==== AUTH_USERNAME
[cols=">h,<9"]
|===============================================================================
|Description|Basic or Digest authentication username.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.7
|===============================================================================

==== CAPTURE
[cols=">h,<9"]
|===============================================================================
|Description|Transaction collection.
|       Type|Collection
|      Scope|Transaction
|     Module|core
|    Version|0.4
|===============================================================================

This collection contains information for the transaction. Currently captured data from operators is stored here in keys "0"-"9".

==== CONSTANT
[cols=">h,<9"]
|===============================================================================
|Description|Collection that contains constants defined with `ConstantSet` or programatically.
|       Type|Collection
|      Scope|Configuration,Transaction
|     Module|constant
|    Version|0.10
|===============================================================================

This collection contains any constants defined via the "constant" module. See the <<_constantset>> directive for an example.

==== FIELD
[cols=">h,<9"]
|===============================================================================
|Description|An alias to the current field being inspected.
|       Type|Variable (same type as the aliased field)
|      Scope|Rule
|     Module|core
|    Version|0.5
|===============================================================================

This field is useful only in field expansions within actions when you must have the original value of the field being inspected. For example:

----
# Log the field value with an event
Rule ARGS @contains attack_string id:123 phase:REQUEST logdata:%{FIELD} event

# Create a collection matching a pattern for later use
Rule REQUEST_HEADERS @rx pattern1 id:124 phase:REQUEST_HEADER setvar:NEW_COL:%{FIELD_NAME}=%{FIELD}
Rule ARGS @rx pattern2 id:125 phase:REQUEST setvar:NEW_COL:%{FIELD_NAME}=%{FIELD}
...
# Then perform further matches on the new collection in another phase, which
# is not possible via chaining.
Rule NEW_COL @rx some_other_patt id:126 phase:REQUEST "msg:Some msg" event block
----

==== FIELD_NAME
[cols=">h,<9"]
|===============================================================================
|Description|An alias to the current field name being inspected, not including the collection name if it is a sub-field in a collection.
|       Type|Variable (same type as the aliased field)
|      Scope|Rule
|     Module|core
|    Version|0.5
|===============================================================================

This field is useful only in field expansions within actions when you must have the name of the field being inspected. The collection name is not prepended, so if `ARGS:foo` is being inspected, the value will be `foo`, not `ARGS:foo`. If you want the full name with the collection prepended, then use `FIELD_NAME_FULL`.

==== FIELD_NAME_FULL
[cols=">h,<9"]
|===============================================================================
|Description|An alias to the current field name being inspected, including the collection name if it is a sub-field in a collection.
|       Type|Variable (same type as the aliased field)
|      Scope|Rule
|     Module|core
|    Version|0.5
|===============================================================================

This field is useful only in field expansions within actions when you must have the full name of the field being inspected. See `FIELD_NAME`.

==== GEOIP
[cols=">h,<9"]
|===============================================================================
|Description|If the _geoip_ module is loaded, then a lookup will be performed on the remote (client) address and the results placed in this collection.
|       Type|Collection
|      Scope|Transaction
|     Module|geoip
|    Version|0.3
|===============================================================================

NOTE: The address used during lookup is the same as that stored in the `REMOTE_ADDR` field, which may be modified from the actual connection (TCP) level address by the `trusted_proxy` module.

Sub-Fields (not all are available prior to GeoIP v1.4.6):

* *latitude:* Numeric latitude rounded to nearest integral value (no floats yet).
* *longitude:* Numeric longitude rounded to nearest integral value (no floats yet).
* *area_code:* Numeric area code (US only).
* *charset:* Numeric character set code.
* *country_code:* Two character country code.
* *country_code3:* Three character country code.
* *country_name:* String country name.
* *region:* String region name.
* *city:* String city name.
* *postal_code:* String postal code.
* *continent_code:* String continent code.
* *accuracy_radius:* Numeric accuracy radius (v1.4.6+).
* *metro_code:* Numeric metro code (v1.4.6+).
* *country_conf:* String country confidence (v1.4.6+).
* *region_conf:* String region confidence (v1.4.6+).
* *city_conf:* String city confidence (v1.4.6+).
* *postal_conf:* String postal code confidence (v1.4.6+).

==== HTP_REQUEST_FLAGS
[cols=">h,<9"]
|===============================================================================
|Description|Collection of LibHTP request parsing flags.
|       Type|Collection
|      Scope|Transaction
|     Module|htp
|    Version|0.3
|===============================================================================

The LibHTP parser will set various flags while parsing. This is a collection of those flags for request parsing. The following flags may be set:

* *FIELD_UNPARSEABLE* An unparseable field was given.
* *FIELD_INVALID* An invalid field was sent.
* *FIELD_FOLDED* Folding detected in a field.
* *FIELD_REPEATED* A field was repeated.
* *FIELD_LONG* A field length was longer than allowed.
* *FIELD_RAW_NUL* A field contained an unencoded NUL (zero) byte.
* *HOST_AMBIGUOUS* The host was specified in both the URI and in the Host header, but they do not match.
* *HOST_MISSING* The host was missing from a request in which it is normally sent.
* *HOSTH_INVALID* Invalid host detected in header.
* *HOSTU_INVALID* Invalid host detected in URL.
* *INVALID_FOLDING* Invalid header folding detected.
* *INVALID_CHUNKING* Invalid chunking detected.
* *MULTI_PACKET_HEAD* The header was sent in more than one packet (buffer).
* *PATH_ENCODED_NUL* A NUL (zero) byte was sent, encoded, in the path.
* *PATH_ENCODED_SEPARATOR* An encoded path separator was sent in the path.
* *PATH_HALF_FULL_RANGE* An invalid full width character was used in the path.
* *PATH_INVALID* An invalid path detected.
* *PATH_INVALID_ENCODING* Invalid encoding was used in the path.
* *PATH_OVERLONG_U* An overlong Unicode encoding was used in the path.
* *PATH_UTF8_VALID* A UTF-8 character was used in the path.
* *PATH_UTF8_INVALID* An invalid UTF-8 encoding was used in the path.
* *PATH_UTF8_OVERLONG* An overlong UTF-8 encoding was used in the path.
* *REQUEST_SMUGGLING* A HTTP smuggling attack was detected.
* *URLEN_ENCODED_NUL* An encoded NUL (zero) byte detected in URL.
* *URLEN_HALF_FULL_RANGE* An invalid full width character detected in URL.
* *URLEN_INVALID_ENCODING* An invalid encoding detected in URL.
* *URLEN_OVERLONG_U* An overlong unicode character detected in URL.

==== HTP_RESPONSE_FLAGS
[cols=">h,<9"]
|===============================================================================
|Description|Collection of LibHTP response parsing flags.
|       Type|Collection
|      Scope|Transaction
|     Module|htp
|    Version|0.3
|===============================================================================

The LibHTP parser will set various flags while parsing. This is a collection of those flags for response parsing. The following flags may be set:

* *FIELD_UNPARSEABLE* An unparseable field was given.
* *FIELD_INVALID* An invalid field was sent.
* *FIELD_FOLDED* Folding detected in a field.
* *FIELD_REPEATED* A field was repeated.
* *FIELD_LONG* A field length was longer than allowed.
* *FIELD_RAW_NUL* A field contained an unencoded NUL (zero) byte.
* *INVALID_CHUNKING:* Invalid chunking was used.
* *INVALID_FOLDING:* Invalid header folding was used.
* *MULTI_PACKET_HEAD:* The header was sent in more than one packet (buffer).
* *STATUS_LINE_INVALID:* An invalid HTTP status code was sent.

==== REMOTE_ADDR
[cols=">h,<9"]
|===============================================================================
|Description|Remote (client) IP address, extracted from the TCP connection. Can be in IPv4 or IPv6 format.
|       Type|String
|      Scope|Connection
|     Module|core
|    Version|0.2
|===============================================================================

NOTE: If the `trusted_proxy` module is also loaded, then the client address may be corrected using any available proxy headers (currently `X-Forwarded-For`).

==== REMOTE_PORT
[cols=">h,<9"]
|===============================================================================
|Description|Remote (client) port, extracted from the TCP connection.
|       Type|Numeric
|      Scope|Connection
|     Module|core
|    Version|0.2
|===============================================================================

==== REQUEST_BODY_PARAMS
[cols=">h,<9"]
|===============================================================================
|Description|Request parameters transported in request body.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.4
|===============================================================================

NOTE: The names and values are already URL decoded.

==== REQUEST_COOKIES
[cols=">h,<9"]
|===============================================================================
|Description|Collection of request cookies (name/value pairs).
|       Type|Collection
|      Scope|Transaction (`REQUEST_HEADERS`)
|     Module|core
|    Version|0.2
|===============================================================================

==== REQUEST_HEADERS
[cols=">h,<9"]
|===============================================================================
|Description|Collection of request headers (name/value pairs).
|       Type|Collection
|      Scope|Transaction (`REQUEST_HEADERS`)
|     Module|core
|    Version|0.2
|===============================================================================

==== REQUEST_HOST
[cols=">h,<9"]
|===============================================================================
|Description|Request hostname information, extracted from the request and normalized.
|       Type|String
|      Scope|Transaction (`REQUEST_HEADERS`)
|     Module|core
|    Version|0.2
|===============================================================================

The following rules apply:

* Use the hostname information if provided on the request line
* Alternatively, look up the HTTP `Host` request header
* If the hostname information is provided in both locations, the
information in the HTTP `Host` request header is ignored

Normalization [TODO What RFC should we refer to?]:

* Lowercase
* Remove trailing dot [TODO What dot?]
* [TODO Remove port?]

==== REQUEST_LINE
[cols=">h,<9"]
|===============================================================================
|Description|Full, raw, request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

.Example
----
GET /path/to/page?a=5&q=This+is+a+test. HTTP/1.1
----

==== REQUEST_METHOD
[cols=">h,<9"]
|===============================================================================
|Description|Request method.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

This field contains the HTTP method used for the request.

==== REQUEST_PROTOCOL
[cols=">h,<9"]
|===============================================================================
|Description|Request protocol name and version.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|o.3
|===============================================================================

This field contains the HTTP protocol name and version, as specified on the request line. Transactions that do not specify the protocol (e.g., HTTP prior to 1.0) will have an empty string value.

==== REQUEST_URI
[cols=">h,<9"]
|===============================================================================
|Description|Request URI, extracted from request and normalized according to the current personality.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.2
|===============================================================================

Default normalization:

* RFC normalization
* Convert to lowercase
* Reduce consecutive forward slashes to a single character

All normalization options:

* RFC normalization
* Convert to lowercase
* Convert \ characters to /
* Reduce consecutive forward slashes to a single character

==== REQUEST_URI_FRAGMENT
[cols=">h,<9"]
|===============================================================================
|Description|Parsed fragment portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

==== REQUEST_URI_HOST
[cols=">h,<9"]
|===============================================================================
|Description|Parsed host portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

This is the hostname specified in the URI. Note that this may be different from the normalized host, which is in `REQUEST_HOST`.

==== REQUEST_URI_PARAMS
[cols=">h,<9"]
|===============================================================================
|Description|Request parameters transported in query string.
|       Type|Collection
|      Scope|Transaction (`REQUEST_HEADERS`)
|     Module|core
|    Version|0.2
|===============================================================================

NOTE: The names and values are already URL decoded.

==== REQUEST_URI_PASSWORD
[cols=">h,<9"]
|===============================================================================
|Description|Parsed password portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

==== REQUEST_URI_PATH
[cols=">h,<9"]
|===============================================================================
|Description|Parsed and normalized path portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

==== REQUEST_URI_PATH_RAW
[cols=">h,<9"]
|===============================================================================
|Description|Parsed (raw) path portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

NOTE: As no URL decoding is performed (this is a raw value), you probably want `REQUEST_URI_PATH_RAW.urlDecode()` in most cases.

==== REQUEST_URI_PORT
[cols=">h,<9"]
|===============================================================================
|Description|Parsed port portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

==== REQUEST_URI_RAW
[cols=">h,<9"]
|===============================================================================
|Description|Raw, unnormalized, request URI from the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.2
|===============================================================================

==== REQUEST_URI_SCHEME
[cols=">h,<9"]
|===============================================================================
|Description|Parsed scheme portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

==== REQUEST_URI_QUERY
[cols=">h,<9"]
|===============================================================================
|Description|Parsed query portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

==== REQUEST_URI_USERNAME
[cols=">h,<9"]
|===============================================================================
|Description|Parsed username portion of the URI within the request line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

==== RESPONSE_HEADERS
[cols=">h,<9"]
|===============================================================================
|Description|Collection of response headers (name/value pairs).
|       Type|Collection
|      Scope|Transaction
|     Module|core
|    Version|0.2
|===============================================================================

==== RESPONSE_LINE
[cols=">h,<9"]
|===============================================================================
|Description|Full response line.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

Transactions that do not specify a response line (e.g., HTTP prior to 1.0) will have an empty string value.

.Example
----
HTTP/1.1 200 OK
----

==== RESPONSE_MESSAGE
[cols=">h,<9"]
|===============================================================================
|Description|Response status message.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

This field contains the status message (text following the status code), as specified on the response line. Transactions that do not specify a response line (e.g., HTTP prior to 1.0) will have an empty string value.

==== RESPONSE_PROTOCOL
[cols=">h,<9"]
|===============================================================================
|Description|Response protocol name and version.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

This field contains the protocol name and version, as specified on the response line. Transactions that do not specify a response line (e.g., HTTP prior to 1.0) will have an empty string value.

==== RESPONSE_STATUS
[cols=">h,<9"]
|===============================================================================
|Description|Response status code.
|       Type|String
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

This field contains the status code, as specified on the response line.  Transactions that do not specify a response line (e.g., HTTP prior to 1.0) will have an empty string value.

==== SERVER_ADDR
[cols=">h,<9"]
|===============================================================================
|Description|Server IP address, extracted from the TCP connection. Canbe in IPv4 or IPv6 format.
|       Type|String
|      Scope|Connection
|     Module|core
|    Version|0.2
|===============================================================================

==== SERVER_PORT
[cols=">h,<9"]
|===============================================================================
|Description|Server port, extracted from the TCP connection.
|       Type|Numeric
|      Scope|Connection
|     Module|core
|    Version|0.2
|===============================================================================

==== THREAT_LEVEL
[cols=">h,<9"]
|===============================================================================
|Description|Stores the current threat level (0-100) which will also be written to the audit log.
|       Type|Numeric
|      Scope|Transaction
|     Module|core
|    Version|0.9
|===============================================================================

IronBee supports the concept of calculating a threat level score for the transaction. The default calculation is to use to average severity across all unsurpressed events, but this calculation is only performed by default when the audit log is written if there is no value for this field. It is intended that other modules implement calculating and exporting this value through this field over the transaction lifecycle. Modules doing this will allow rules and other modules to utilize this field, but without this additional support the field will only be used at audit log generation time.

==== TX
[cols=">h,<9"]
|===============================================================================
|Description|Transaction collection.
|       Type|Collection
|      Scope|Transaction
|     Module|core
|    Version|0.3
|===============================================================================

This collection contains arbitrary information for the transaction. It is a generic place for rules to store transaction data in which other rules can monitor.

==== UA
[cols=">h,<9"]
|===============================================================================
|Description|User agent information extracted from the request.
|       Type|Collection
|      Scope|Transaction
|     Module|user_agent
|    Version|0.3
|===============================================================================

NOTE: While the `User-Agent` HTTP request header may be used in generating these fields, the term "user agent" here refers to the client as a whole.

Sub-Fields:

* *agent:* String name of the user agent.
* *product:* String product deduced from the user agent data.
* *os:* String operating system deduced from user agent data.
* *extra:* Any extra string available after parsing the `User-Agent` HTTP request header.
* *category:* String category deduced from user agent data.

=== Transformation Functions

Transformations allow manipulating data for inspection. This can be used to normalize data, convert data types or perform an operation on the data.

==== compressWhitespace
[cols=">h,<9"]
|===============================================================================
|Description|Replaces one or more consecutive whitespace characters with a single space.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.3
|===============================================================================

Replaces various whitespace characters with spaces. In addition, consecutive whitespace characters will be reduced down to a single space. Whitespace characters are: `0x20`, `\f`, `\t`, `\n`, `\r`, `\v`, `0xa0` (non-breaking whitespace).

==== count
[cols=">h,<9"]
|===============================================================================
|Description|Given a collection, it returns the number if items in the collection. Given a scalar, returns 1.
|  InputType|Collection
| OutputType|Integer
|     Module|core
|    Version|0.4
|===============================================================================

==== first
[cols=">h,<9"]
|===============================================================================
|Description|Return the first item in a collection or filter.
|  InputType|Any
| OutputType|Same as Input
|     Module|core
|    Version|0.8
|===============================================================================

Collections (and filters on collections) can contain multiple entries with the same name. To allow for returning only a single item, you can use the `first` transformation to retrieve only the first value in the list.

.Example
----
Rule ARGS:a.first() @rx patt id:1 phase:REQUEST ...
----

==== htmlEntityDecode
[cols=">h,<9"]
|===============================================================================
|Description|Decodes HTML entities in the data.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.6
|===============================================================================

The following forms are supported:

* *&#DDDD;* - Numeric code point, where DDDD represents a decimal number with any number of digits.
* *&#xHHHH;* - Numeric code point, where HHHH represents a hexadecimal number with any number of digits.
* *&name;* - Predefined XML named entities (currently: quot, amp, apos, lt, gt).

See: https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references

==== iceil
[cols=">h,<9"]
|===============================================================================
|Description|Return the integral value greater than or equal to the numeric value of the input.
|  InputType|Numeric
| OutputType|Integer
|     Module|core
|    Version|0.9
|===============================================================================

==== ifloor
[cols=">h,<9"]
|===============================================================================
|Description|Return the integral value less than or equal to the numeric value of the input.
|  InputType|Numeric
| OutputType|Integer
|     Module|core
|    Version|0.9
|===============================================================================

==== iround
[cols=">h,<9"]
|===============================================================================
|Description|Return the integral value closest to the numeric value of the input.
|  InputType|Numeric
| OutputType|Intaeger
|     Module|core
|    Version|0.9
|===============================================================================

==== last
[cols=">h,<9"]
|===============================================================================
|Description|Return the last item in a collection or filter.
|  InputType|Any
| OutputType|Same as Input
|     Module|core
|    Version|0.8
|===============================================================================

Collections (and filters on collections) can contain multiple entries with the same name. To allow for returning only a single item, you can use the `last` transformation to retrieve only the last value in the list.

.Example
----
Rule ARGS:a.last() @rx patt id:1 phase:REQUEST ...
----

==== length
[cols=">h,<9"]
|===============================================================================
|Description|Returns the byte length of the value.
|  InputType|String
| OutputType|Integer
|     Module|core
|    Version|0.4
|===============================================================================

==== lowercase
[cols=">h,<9"]
|===============================================================================
|Description|Returns the input as all lower case characters.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.2
|===============================================================================

NOTE: It is often much more efficient to use case insensitive operators instead of transforming to lowercase.

==== max
[cols=">h,<9"]
|===============================================================================
|Description|Given a collection of numeric data, returns the maximum value.
|  InputType|Collection
| OutputType|Numeric
|     Module|core
|    Version|0.3
|===============================================================================

==== min
[cols=">h,<9"]
|===============================================================================
|Description|Given a collection of numeric data, returns the minimum value.
|  InputType|Collection
| OutputType|Numeric
|     Module|core
|    Version|0.3
|===============================================================================

==== name
[cols=">h,<9"]
|===============================================================================
|Description|Returns the name of the field as the value.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.6
|===============================================================================

==== names
[cols=">h,<9"]
|===============================================================================
|Description|Returns a collection of names from a collection of name/value pairs.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.6
|===============================================================================

==== normalizePath
[cols=">h,<9"]
|===============================================================================
|Description|Normalize a filesystem path, removing back and self references.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.6
|===============================================================================

==== normalizePathWin
[cols=">h,<9"]
|===============================================================================
|Description|Normalize a Windows filesystem path, removing back and self references.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.6
|===============================================================================

==== normalizeSqli
[cols=">h,<9"]
|===============================================================================
|Description|Normalize potential SQL injection via libinjection.
|  InputType|String
| OutputType|String
|     Module|libinjection
|    Version|0.7
|===============================================================================

The libinjection ironbee module utilizes Nick Galbreath's libinjection to implement SQLi detection. This transformation is based on an example in libinjection. The libinjection library is available via: http://www.client9.com/projects/libinjection/

.Example Input
----
Input: foo' /* x */   or 1/* y -- */=/* z */1 union select id,passwd from users --
----

.Example Output
----
Output: foo' or 1=1 union select id,passwd from users --
----

==== normalizeSqlPg
[cols=">h,<9"]
|===============================================================================
|Description|Normalize postgres SQL.
|  InputType|String
| OutputType|String
|     Module|sqltfn
|    Version|0.7
|===============================================================================

Normalize Postgres SQL.

.Example Input
----
Input: foo' /* x */   or 1/* y -- */=/* z */1 union select id,passwd from users --
----

.Example Output
----
Output: foo' or 1 = 1 union select id,passwd from users
----

==== removeWhitespace
[cols=">h,<9"]
|===============================================================================
|Description|Removes one or more consecutive whitespace characters.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.3
|===============================================================================

Similar to `compressWhitespace`, except removes the characters instead of replacing them with a single space.

==== toFloat
[cols=">h,<9"]
|===============================================================================
|Description|Convert input to a numeric floating point type.
|  InputType|Any
| OutputType|String
|     Module|core
|    Version|0.8
|===============================================================================

==== toInteger
[cols=">h,<9"]
|===============================================================================
|Description|Convert input to a numeric integral type.
|  InputType|Any
| OutputType|String
|     Module|core
|    Version|0.8
|===============================================================================

==== toString
[cols=">h,<9"]
|===============================================================================
|Description|Convert input to a string type.
|  InputType|Any
| OutputType|String
|     Module|core
|    Version|0.8
|===============================================================================

==== trim
[cols=">h,<9"]
|===============================================================================
|Description|Removes consecutive whitespace from the beginning and end of the input.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.2
|===============================================================================

==== trimLeft
[cols=">h,<9"]
|===============================================================================
|Description|Removes consecutive whitespace from the beginning of the input.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.2
|===============================================================================

==== trimRight
[cols=">h,<9"]
|===============================================================================
|Description|Removes consecutive whitespace from the end of the input.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.2
|===============================================================================

==== urlDecode
[cols=">h,<9"]
|===============================================================================
|Description|Decodes URL encoded values in the input.
|  InputType|String
| OutputType|String
|     Module|core
|    Version|0.7
|===============================================================================

Implements decoding the encoding used in application/x-www-form-urlencoded values (percent encoding with additions).

* *%HH;* - Numeric code point, where HH represents a two digit hexadecimal number.
* *+* - Represents an ASCII space character (equiv to `%20`).

Fields which are parsed from the URI and form parameters are already URL Decoded and you should not apply this transformation to these fields unless you are trying to inspect multiple levels of encoding.

=== Operators

Operators execute some operation over the input. Each operator is configured with a parameter in a format interpreted by the operator. At runtime the the operator is executed with this parameter and a field as input. Rule actions are executed depending on the return value (true or false) for the operator.

==== clipp_print
[cols=">h,<9"]
|===============================================================================
|Description|Print the message followed by the value of the target, then return true.
|     Syntax|`clipp_print <message>`
|      Types|Scalar
|     Module|clipp
|    Version|0.8
|===============================================================================

Primarily for processing tests and debugging, this operator allows printing out the value of the target prefixed by a message. This operator is only available when executing under the clipp command line tool.

.Example of clipp test utilizing clipp_print in Ruby
----
def test_setvar_init_float
  clipp(
    :input_hashes => [simple_hash("GET /foobar/a\n")],
    :config => """
      InitVar A 2.toFloat()
    """,
    :default_site_config => <<-EOS
      Rule A @clipp_print_type "type of A" id:1 rev:1 phase:REQUEST_HEADER
      Rule A @clipp_print      "val of A"  id:2 rev:1 phase:REQUEST_HEADER
    EOS
  )
  assert_log_match /val of A.*2/
  assert_log_match /type of A.*FLOAT/
end
----

==== clipp_print_type
[cols=">h,<9"]
|===============================================================================
|Description|Print the message followed by the type of the target, then return true.
|     Syntax|`clipp_print <message>`
|      Types|Any
|     Module|clipp
|    Version|0.8
|===============================================================================

This is similar to `clipp_print`, but prints the target type instead of value.  See the example under <<_clipp_print>>.

==== contains
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target contains the given sub-string.
|     Syntax|`contains <sub-string>`
|      Types|String
|     Module|core
|    Version|0.3
|===============================================================================

==== dfa
[cols=">h,<9"]
|===============================================================================
|Description|Deterministic finite atomation matching algorithm (PCRE'salternative matching algorithm).
|     Syntax|`dfa`
|      Types|String
|     Module|pcre
|    Version|0.4
|===============================================================================

The `dfa` operator implements the alternative matching algorithm in the http://www.pcre.org/[PCRE] regular expressions library. The parameter of the operator is a regular expression pattern that is passed to the PCRE library without modification. This alternative matching algorithm uses a similar syntax to PCRE regular expressions, except that backtracking is not available. The primary use of `dfa` is to allow a subset of regular expression matching in a streaming manner (see `StreamInspect`). In addition to streaming support, dfa will also find all matches to the pattern when the capture modifier is used. TODO: Describe limits on regex syntax.

.Example of capturing multiple matches
----
# Capture each item in a '&' separated list
Rule REQUEST_URI_QUERY @dfa "[^&]*" id:1 rev:1 phase:REQUEST_HEADER capture
# Inspect each element in the CAPTURE, blocking if the format does not match
Rule CAPTURE !@rx ".=." id:2 rev:1 phase:REQUEST_HEADER "msg:Name and value required" event block
----

==== ee
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target matches any value in the named eudoxus automata.
|     Syntax|`ee <named-automata>`
|      Types|String
|     Module|ee
|    Version|0.7
|===============================================================================

The `ee` operator is the "Eudoxus Executor". If the target matches any pattern in the named Eudoxus automata, then the operator returns true. The named eudoxus automata must first be loaded with the the <<_loadeudoxus>> directive.

See also <<_ee_match>> which is similar, but must match the entire target.

==== ee_match
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target fully matches any value in the named eudoxus automata.
|     Syntax|`ee_match <named-automata>`
|      Types|String
|     Module|ee
|    Version|0.7
|===============================================================================

Similar to <<_match>> and <<_ee>>, the operator returns true if the target fully matches (pattern anchored start to end) in the named eudoxus automata.

==== eq
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target is numerically equal to the given value.
|     Syntax|`eq <value>`
|      Types|Numeric
|     Module|core
|    Version|0.3
|===============================================================================

The given value will evaluate any field expansions. It is an error if the value is not numeric.

==== exists
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target exists (is defined).
|     Syntax|`exists <value>`
|      Types|Any
|     Module|testops
|    Version|0.9
|===============================================================================

Primarily used in testing, this operator returns true if the target exists.

==== false
[cols=">h,<9"]
|===============================================================================
|Description|Always returns false, ignoring its parameter.
|     Syntax|`false "ignored"`
|      Types|Any
|     Module|testops
|    Version|0.9
|===============================================================================

Primarily used in testing, this operator always returns false, allowing easier testing of negated actions (actions that execute on a false return from an operator).

==== ge
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target is numerically greater than or equal to the given value.
|     Syntax|`ge <value>`
|      Types|Numeric
|     Module|core
|    Version|0.3
|===============================================================================

The given value will evaluate any field expansions. It is an error if the value is not numeric.

==== gt
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target is numerically greater than the given value.
|     Syntax|`gt <value>`
|      Types|Numeric
|     Module|core
|    Version|0.3
|===============================================================================

The given value will evaluate any field expansions. It is an error if the value is not numeric.

==== imatch
[cols=">h,<9"]
|===============================================================================
|Description|As `match`, but case insensitive.
|     Syntax|`imatch <value1 value2 ... valueN>`
|      Types|String
|     Module|core
|    Version|0.7
|===============================================================================

==== ipmatch
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if a target IPv4 address matches any given whitespace separated address in CIDR format.
|     Syntax|`ipmatch <cidr1 cidr2 ... cidrN>`
|      Types|String
|     Module|core
|    Version|0.3
|===============================================================================

==== ipmatch6
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if a target IPv6 address matches any given whitespace separated address in CIDR format.
|     Syntax|`ipmatch6 <cidr1 cidr2 ... cidrN>`
|      Types|String
|     Module|core
|    Version|0.3
|===============================================================================

==== is_float
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target type is a float, ignoring its parameter.
|     Syntax|`is_float "ignored"`
|      Types|Any
|     Module|testops
|    Version|0.9
|===============================================================================

Primarily used in testing, this operator allows inspecting target types.

==== is_int
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target type is an integer, ignoring its parameter.
|     Syntax|`is_int "ignored"`
|      Types|Any
|     Module|testops
|    Version|0.9
|===============================================================================

Primarily used in testing, this operator allows inspecting target types.

==== is_sbuffer
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target type is a stream buffer, ignoring its parameter.
|     Syntax|`is_sbuffer "ignored"`
|      Types|Any
|     Module|testops
|    Version|0.9
|===============================================================================

Primarily used in testing, this operator allows inspecting target types.

==== is_sqli
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the data is determined to be SQL injection via the libinjection library.
|     Syntax|`is_sqli <"default" | pattern-set-name>`
|      Types|String
|     Module|libinjection
|    Version|0.7
|===============================================================================

The libinjection ironbee module utilizes Nick Galbreath's libinjection to implement SQLi and XSS detection. This operator is similar to libinjection's libinjection_is_sqli() function. The libinjection library is available via: http://www.client9.com/projects/libinjection/

The pattern set can be set to "default" to use the default libinjection set, or can be changed to use a custom named set mapped via the <<_sqlipatternset>> directive.

.Example
----
Rule ARGS @is_sqli default id:test/sqli/1 phase:REQUEST "msg:Detected SQLi" logdata:%{FIELD} event block:phase
----

==== is_xss
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the data is determined to be Cross Side Scripting (XSS) via the libinjection library.
|     Syntax|`is_xss <"default"> `
|      Types|String
|     Module|libinjection
|    Version|0.10
|===============================================================================

The libinjection ironbee module utilizes Nick Galbreath's libinjection to implement SQLi and XSS detection. This operator is similar to libinjection's libinjection_is_xss() function. The libinjection library is available via: http://www.client9.com/projects/libinjection/

The pattern set can currently only be set to "default".

.Example
----
Rule ARGS @is_xss default id:test/xss/1 phase:REQUEST "msg:Detected XSS" logdata:%{FIELD} event block:phase
----

==== is_string
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target type is a string, ignoring its parameter.
|     Syntax|`is_float "ignored"`
|      Types|Any
|     Module|testops
|    Version|0.9
|===============================================================================

Primarily used in testing, this operator allows inspecting target types.

==== is_time
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target type is a timeval, ignoring its parameter.
|     Syntax|`is_float "ignored"`
|      Types|Any
|     Module|testops
|    Version|0.9
|===============================================================================

Primarily used in testing, this operator allows inspecting target types.

==== istreq
[cols=">h,<9"]
|===============================================================================
|Description|As `streq`, but case insensitive.
|     Syntax|`istreq <value>`
|      Types|String
|     Module|core
|    Version|0.7
|===============================================================================

==== le
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target is numerically less than or equal to the given value.
|     Syntax|`le <value>`
|      Types|Numeric
|     Module|core
|    Version|0.3
|===============================================================================

The given value will evaluate any field expansions. It is an error if the value is not numeric.

==== lt
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target is numerically less than the given value.
|     Syntax|`lt <value>`
|      Types|Numeric
|     Module|core
|    Version|0.3
|===============================================================================

The given value will evaluate any field expansions. It is an error if the value is not numeric.

==== match
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target is any of the given whitespace separated words.
|     Syntax|`match <value1 value2 ... valueN>`
|      Types|String
|     Module|core
|    Version|0.7
|===============================================================================

.Example
----
Rule REQUEST_METHOD !@match "GET HEAD POST" \
    id:test/1 phase:REQUEST_HEADER "msg:Not a known method" logdata:%{FIELD} event block:phase
----

==== ne
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if the target is not numerically equal to the given value.
|     Syntax|`ne`
|      Types|Numeric
|     Module|core
|    Version|0.3
|===============================================================================

The given value will evaluate any field expansions. It is an error if the value is not numeric.

==== nop
[cols=">h,<9"]
|===============================================================================
|Description|No operation performed. Always returns true and ignores its parameter.
|     Syntax|`nop "ignored"`
|      Types|Any
|     Module|core
|    Version|0.3
|===============================================================================

==== parseAuthority
[cols=">h,<9"]
|===============================================================================
|Description|Parse the authority out of a URI, capturing the values.
|     Syntax|`parseAuthority "ignored"`
|      Types|Any
|     Module|ps
|    Version|0.9
|===============================================================================

Part of the parser suite module which can provide lighter weight parsing.

Parsed values in the capture collection::
  * username
  * password
  * host
  * port

.Example
----
Rule REQUEST_URI_RAW @parseAuthority "" \
    id:1 phase:REQUEST_HEADER CAPTURE:PARSED_AUTH
Rule PARSED_AUTH:password @rx "some patt" \
    id:2 phase:REQUEST_HEADER "msg:Weak password" event
----

==== parsePath
[cols=">h,<9"]
|===============================================================================
|Description|Parse the path out of a URI, capturing the values.
|     Syntax|`parsePath "ignored"`
|      Types|Any
|     Module|ps
|    Version|0.9
|===============================================================================

Part of the parser suite module which can provide lighter weight parsing.

The parameter is interpreted as a path and extension separator.

Parsed values in the capture collection::
  * directory
  * file
  * base
  * extension

.Example
----
Rule REQUEST_URI_RAW @parsePath "/."
    id:1 phase:REQUEST_HEADER CAPTURE:PARSED_PATH
Rule PARSED_PATH:file @rx "some patt" \
    id:2 phase:REQUEST_HEADER "msg:Bad filename" event
----

==== parseRequestLine
[cols=">h,<9"]
|===============================================================================
|Description|Parse the request line, capturing the values.
|     Syntax|`parseRequestLine "ignored"`
|      Types|Any
|     Module|ps
|    Version|0.9
|===============================================================================

Part of the parser suite module which can provide lighter weight parsing.

Parsed values in the capture collection::
  * method
  * uri
  * version

.Example
----
Rule REQUEST_LINE @parseRequestLine ""
    id:1 phase:REQUEST_HEADER CAPTURE:PARSED_LINE
Rule PARSED_LINE:method !@imatch "GET HEAD POST" \
    id:2 phase:REQUEST_HEADER "msg:Bad method" event
----

==== parseResponseLine
[cols=">h,<9"]
|===============================================================================
|Description|Parse the response line, capturing the values.
|     Syntax|`parseResponseLine "ignored"`
|      Types|Any
|     Module|ps
|    Version|0.9
|===============================================================================

Part of the parser suite module which can provide lighter weight parsing.

Parsed values in the capture collection::
  * version
  * status
  * message

.Example
----
Rule RESPONSE_LINE @parseResponseLine ""
    id:1 phase:RESPONSE_HEADER CAPTURE:PARSED_LINE
Rule PARSED_LINE:message @rx "some patt" \
    id:2 phase:RESPONSE_HEADER "msg:Bad response" event
----

==== parseURI
[cols=">h,<9"]
|===============================================================================
|Description|Parse the URI, capturing the values.
|     Syntax|`parseUri "ignored"`
|      Types|Any
|     Module|ps
|    Version|0.9
|===============================================================================

Part of the parser suite module which can provide lighter weight parsing.

Parsed values in the capture collection::
  * scheme
  * authority
  * path
  * query
  * fragment

.Example
----
Rule REQUEST_URI_RAW @parseURI ""
    id:1 phase:REQUEST_HEADER CAPTURE:PARSED_URI
Rule PARSED_URI:path @rx "some patt" \
    id:2 phase:REQUEST_HEADER "msg:Bad URI path" event
----

==== pcre
[cols=">h,<9"]
|===============================================================================
|Description|As `rx`
|     Syntax|`pcre <regex>`
|      Types|String
|     Module|pcre
|    Version|0.2
|===============================================================================

Same as the `rx` operator.

==== rx
[cols=">h,<9"]
|===============================================================================
|Description|Regular expression (perl compatible regular expression) matching.
|     Syntax|`rx`
|      Types|String
|     Module|pcre
|    Version|0.2
|===============================================================================

The `rx` operator implements http://www.pcre.org/[PCRE] regular
expressions. The parameter of the operator is a regular expression
pattern that is passed to the PCRE library without modification.

----
Rule ARGS:userId !@rx "^[0-9]+$"
----

Patterns are compiled with the following settings::
  * Entire input is treated as a single buffer against which matching is done.
  * Patterns are case-sensitive by default.
  * Patterns are compiled with `PCRE_DOTALL` and `PCRE_DOLLAR_ENDONLY` set.

Using captured substrings to create variables

Regular expressions can be used to capture substrings. In IronBee, the captured substrings can be used to create new variables in the `CAPTURE` collection. To use this feature, specify the `capture` modifier in the rule.

----
Rule ARGS @rx "test(\d{13,16})" capture
----

When capture is enabled, IronBee will always create a variable `CAPTURE:0`, which will contain the entire matching area of the pattern.  Anonymous capture groups will create up to 9 variables, from `CAPTURE:1` to `CAPTURE:9`. These special `CAPTURE` variables will remain available until the next capture rule is run, when they will all be deleted.

==== streq
[cols=">h,<9"]
|===============================================================================
|Description|Returns true if target exactly matches the given string.
|     Syntax|`streq`
|      Types|String
|     Module|core
|    Version|0.3
|===============================================================================

==== true
[cols=">h,<9"]
|===============================================================================
|Description|Always returns true, ignoring its parameter.
|     Syntax|`true "ignored"`
|      Types|Any
|     Module|testops
|    Version|0.9
|===============================================================================

Primarily used in testing, this operator always returns false, allowing easier testing of actions.

=== Modifiers and Actions

Rule modifiers allow configuring certain aspects of the rule. Rule actions allow performing some action when a rule fires. Actions can be customized by modifiers, such as setting the status code for a block action, or setting the message for an event.

==== allow
[cols=">h,<9"]
|===============================================================================
|Description|Mark a transaction as allowed to proceed to a given inspection point.
|       Type|Action
|     Syntax|`allow[":phase" \| ":request"]`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

By default this allows the transaction to proceed without inspection until the post-processing phase. This can be changed depending on the modifier used:

* *phase* - Proceed to the end of the current phase without further rule execution.
* *request* - Proceed to the end of the request processing phases without further rule execution.

==== block
[cols=">h,<9"]
|===============================================================================
|Description|Mark a transaction to be blocked.
|       Type|Action
|     Syntax|`block[:advisory \| :phase \| :immediate]`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

By default this marks the transaction with an advisory blocking flag. This can be changed depending on the modifier used:

* *advisory* - Mark the transaction with an advisory blocking flag which further rules may take into account.
* *phase* - Block the transaction at the end of the current phase.
* *immediate* - Block the transaction immediately after rule execution.

==== capture
[cols=">h,<9"]
|===============================================================================
|Description|Enable capturing the matching data.
|       Type|Modifier
|     Syntax|`capture[:<name>]`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

Enabling capturing will populate the `CAPTURE` collection with data from the most recent matching operator. For most operators the `CAPTURE:0` field will be set to the last matching value. Operators that support capturing multiple values may set other items in the `CAPTURE` collection. For example, the `rx` operator supports setting the additional `CAPTURE:1` - `CAPTURE:9` via capturing parens in the regular expression and the `dfa` operator supports capturing _all matches_, each being available as `CAPTURE:0`.

If a `name` is specified, then the capture is written to the named collection instead of the `CAPTURE` collection.

----
Rule ARGS @rx "(patt)ern" id:1 capture:MY_CAPTURE_COLLECTION
----

==== chain
[cols=">h,<9"]
|===============================================================================
|Description|Chains the next rule, so that the next rule will execute only if the current operator evaluates true.
|       Type|Modifier
|     Syntax|`chain`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

Rule chains are essentially rules that are bound together by a logical AND with short circuiting. In a rule chain, each rule in the chain is executed in turn as long as the operators are evaluating true. If an operator evaluates to false, then no further rules in the chain will execute. This allows a rule to execute multiple operators.

All rules in the chain will still execute their actions before the next rule in the chain executes. If you want a rule that only executes an action if all operators evaluate true, then the action should be given on the final rule in the chain.

Requirements for chained rules:

* Only the first rule in the chain may have an id or phase, which will be used for all rule chains.
* A numeric chain ID will be assigned and appended to the rule ID, prefixed with a dash, to uniquely identify the rule.
* Different metadata attributes (except id/phase) may be given for each chain, but the first rule's metasta will be the default.
* Specifying one or more tag modifiers is allowed in any chain, but the tags will be bound to the entire rule chain so that RuleEnable and similar will act on the entire rule chain, not just an individual rule in the chain.

.Example
----
# Start a rule chain, which matches only POST requests. The implicit ID here
# will be set to "id:1-1".
Rule REQUEST_METHOD "@rx ^(?i:post)$" id:1 phase:REQUEST chain

# Only if the above rule's operator evaluates true, will the next rule in the
# chain execute. This rule checks to see if there are any URI based parameters
# which typically should not be there for POST requests. If the operator evaluates
# true, then the setvar action will execute, marking the transaction and an
# event will be generated with the given msg text. This rule will have the
# implicit ID set to "id:1-2".
Rule &REQUEST_URI_PARAMS @gt 0 "msg:POST with URI parameters." setvar:TX:uri_params_in_post=1 event chain

# Only if the above two rules' operators return true will the next rule in the
# chain execute.  This rule checks that certain parameters are not used in
# on the URI and if so, generates an event and blocks the transaction with the
# default status code at the end of the phase. This rule will have the implicit
# ID set to "id:1-3".
Rule &REQUEST_URI_PARAMS:/^(id|sess)$/ @gt 0 "msg:Sensitive parameters in URI." event block:phase
----

==== clipp
[cols=">h,<9"]
|===============================================================================
|Description|Clipp defined action to allow filtering content with IronBee rules.
|       Type|Action
|     Syntax|`clipp:<allow \| block \| break>`
|Cardinality|0..n
|     Module|clipp
|    Version|0.4
|===============================================================================

This action is defined by the `clipp` command line utility. See the `clipp` documentation for more information.

==== clipp_announce
[cols=">h,<9"]
|===============================================================================
|Description|Clipp defined action to allow logging data.
|       Type|Action
|     Syntax|`clipp_announce:<message>`
|Cardinality|0..n
|     Module|clipp
|    Version|0.4
|===============================================================================

This action is defined by the `clipp` command line utility. It allows printing a message to the log which can then be used to do assertions in tests.

.Example clipp test in Ruby
----
def test_args_bar
  clipp(
    modhtp: true,
    default_site_config: => <<-EOS
      Rule ARGS @match "bar" id:1 phase:REQUEST_HEADER clipp_announce:A
    EOS
  ) do
    transaction do |t|
      t.request(
        raw: "GET /foo?x=bar HTTP/1.1"
      )
    end
  end
  assert_no_issues
  assert_log_match /CLIPP ANNOUNCE: A/
end
----

==== delRequestHeader
[cols=">h,<9"]
|===============================================================================
|Description|Delete an HTTP header from the request.
|       Type|Action
|     Syntax|`delRequestHeader:<header-name>`
|Cardinality|0..n
|     Module|core
|    Version|0.4
|===============================================================================

NOTE: This functionality is optionally implemented by the server and may not be available in all servers.

==== delResponseHeader
[cols=">h,<9"]
|===============================================================================
|Description|Delete an HTTP header from the response.
|       Type|Action
|     Syntax|`delResponseHeader:<header-name>`
|Cardinality|0..n
|     Module|core
|    Version|0.4
|===============================================================================

NOTE: This functionality is optionally implemented by the server and may not be available in all servers.

==== event
[cols=">h,<9"]
|===============================================================================
|Description|Cause the rule to generate a log event.
|       Type|Action
|     Syntax|`event[":observation" \| ":alert"]`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

By default this generates a log event of type "observation", but this can be changed to type "alert". Having at least one active alert type event will cause an audit log to be generated.

* *observation* - Default event type denoting a rule made an observation, which could contribute to further inspection.
* *alert* - Alert event type denoting a transaction should be logged.

==== logMsg
[cols=">h,<9"]
|===============================================================================
|Description|Write a message to the log.
|       Type|Action
|     Syntax|`logMsg:<message>`
|Cardinality|0..1
|     Module|logmsg
|    Version|0.9
|===============================================================================

NOTE: Could replace clipp_announce for a more generic solution.

==== predicate
[cols=">h,<9"]
|===============================================================================
|Description|Define a predicate s-expression for the rule.
|       Type|Action
|     Syntax|`predicate:<s-expression>`
|Cardinality|0..1
|     Module|predicate
|    Version|0.8
|===============================================================================

See the predicate documentation.

==== set_predicate_vars
[cols=">h,<9"]
|===============================================================================
|Description|Configure predicate to set custom vars (fields).
|       Type|Modifier
|     Syntax|`set_predicate_vars`
|Cardinality|0..1
|     Module|predicate
|    Version|0.9
|===============================================================================

See the predicate documentation.

==== setflag
[cols=">h,<9"]
|===============================================================================
|Description|Set, or unset, boolean transaction attributes (flags).
|       Type|Action
|     Syntax|`setflag:[!]<flag>`
|Cardinality|0..n
|     Module|core
|    Version|0.6
|===============================================================================

Allow setting or unsetting transaction flags. Prefixing with a `!` unsets the flag.

NOTE: Currently the `inspectRequestHeader` flag is always set as this is required for the site selection process. Additionally, the `RequestBuffering` and `ResponseBuffering` directives must be enabled to buffer the request or response.

* *block* - Set if transaction was marked for block.
* *suspicious* - Set if transaction was marked as suspicious and care should be taken in processing.
* *inspectRequestHeader* - Set if the engine should inspect the HTTP request header (default: set).
* *inspectRequestBody* - Set if the engine should inspect the HTTP request body (default: unset).
* *inspectResponseHeader* - Set if the engine should inspect the HTTP response header (default: unset).
* *inspectResponseBody* - Set if the engine should inspect the HTTP response body (default: unset).

==== setRequestHeader
[cols=">h,<9"]
|===============================================================================
|Description|Set the value of a HTTP request header.
|       Type|Action
|     Syntax|`setRequestHeader:<name>=<value>`
|Cardinality|0..n
|     Module|core
|    Version|0.4
|===============================================================================

NOTE: This functionality is optionally implemented by the server and may not be available in all servers.

==== setResponseHeader
[cols=">h,<9"]
|===============================================================================
|Description|Set the value of an HTTP response header.
|       Type|Action
|     Syntax|`setResponseHeader:<name>=<value>`
|Cardinality|0..n
|     Module|core
|    Version|0.4
|===============================================================================

NOTE: This functionality is optionally implemented by the server and may not be available in all servers.

==== setvar
[cols=">h,<9"]
|===============================================================================
|Description|Set a variable data field.
|       Type|Action
|     Syntax|`setvar:[!][+\|-]<name>=<value>`
|Cardinality|0..n
|     Module|core
|    Version|0.2
|===============================================================================

The `setvar` modifier is used for data field manipulation. To create a variable data field or change its value:

----
setvar:tx:score=1
----

To remove all instances of a named variable data field:

----
setvar:!tx:score
----

To increment or decrement a variable data field value:

----
setvar:tx:score+=5
    setvar:tx:score-=5
----

An attempt to modify a value of a non-numerical variable will assume the old value was zero.

NOTE: Probably should just fail, logging an attempt was made to modify a non-numerical value.

==== status
[cols=">h,<9"]
|===============================================================================
|Description|The HTTP status code to use for a blocking action.
|       Type|Modifier
|     Syntax|`status:<http-status-code>`
|Cardinality|0..1
|     Module|core
|    Version|0.4
|===============================================================================

==== t
[cols=">h,<9"]
|===============================================================================
|Description|Apply one or more named transformations to each of the inputs to a rule.
|       Type|Modifier
|     Syntax|`t:<transformation-functions>`
|Cardinality|0..n
|     Module|core
|    Version|0.4
|===============================================================================

==== txDump
[cols=">h,<9"]
|===============================================================================
|Description|Dump the transaction details to the log for debugging.
|       Type|Action
|     Syntax|`txDump`
|Cardinality|0..n
|     Module|txdump
|    Version|0.9
|===============================================================================

Use for debugging when writing rules and diagnosing issues.

